<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siga a Receita - Deluxe Chef!</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome (√çcones) CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Font Inter (Estilo Google) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* Estilo base com a fonte Inter */
        body {
            font-family: 'Inter', sans-serif;
            /* Fundo gradiente vibrante e vivo */
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            overflow: hidden; /* Prevenir scroll */
        }

        /* Container principal do jogo */
        #game-container {
            /* Efeito de vidro fosco (glassmorphism) */
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        /* Bot√µes principais (Menu e A√ß√£o) */
        .btn-main {
            transition: all 0.2s ease;
            transform: scale(1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .btn-main:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .btn-main:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Estilo dos bot√µes de ingrediente */
        .ingredient-btn {
            transition: all 0.15s ease;
            background: #fff;
            color: #333;
            border: 2px solid #ddd;
        }
        .ingredient-btn:hover {
            border-color: #a78bfa; /* Roxo */
            transform: translateY(-2px);
        }
        .ingredient-btn:active {
            transform: scale(0.92);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            background-color: #a78bfa; /* Roxo */
            color: white;
            border-color: #a78bfa;
        }
        
        /* (NOVO) Estilo para o card de "Subir de Ranque" no mercado */
        .rank-up-card {
            border: 3px solid #f59e0b; /* Amarelo/Ouro */
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.6);
            transform: scale(1.02);
            background-color: #fffbeb; /* Fundo amarelo claro */
        }
        .rank-up-card:hover {
            background-color: #fffbeb;
        }

        /* Anima√ß√µes */
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-in { animation: pop-in 0.3s ease-out forwards; }
        
        @keyframes slide-in-bottom {
            0% { transform: translateY(100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-in-bottom { animation: slide-in-bottom 0.5s ease-out forwards; }

        @keyframes countdown {
            from { width: 100%; }
            to { width: 0%; }
        }
        .timer-bar-inner-animate { animation: countdown 10s linear forwards; }
        
        /* Bal√£o de fala melhorado */
        .speech-bubble {
            position: relative;
            background: #f3f4f6; /* Cinza claro */
            border-radius: .4em;
            padding: 1rem 1.25rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 15%;
            width: 0; height: 0;
            border: 20px solid transparent;
            border-top-color: #f3f4f6; /* Cor igual ao bal√£o */
            border-bottom: 0;
            margin-left: -10px;
            margin-bottom: -20px;
        }
        
        /* Classes de feedback */
        .message-success { color: #10b981; /* Verde */ transform: scale(1); opacity: 1; }
        .message-error { color: #ef4444; /* Vermelho */ transform: scale(1); opacity: 1; }
        #message-box {
            transition: all 0.3s ease;
            transform: scale(0.8);
            opacity: 0;
            height: 2.5rem; /* Altura fixa */
        }
        
        /* Combo (Streak) */
        @keyframes pulse-orange {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.9; }
        }
        .animate-pulse-orange { animation: pulse-orange 0.3s ease-out; }

        /* (NOVO) Anima√ß√£o para a tela de sucesso */
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.9; }
        }
        .animate-pulse-success {
            animation: pulse-success 0.4s ease-out;
        }

        /* (NOVO) Anima√ß√£o para o NPC ao receber um pedido */
        @keyframes rotate-in {
            0% { transform: translateY(-50px) rotateY(180deg); opacity: 0; }
            100% { transform: translateY(0) rotateY(0deg); opacity: 1; }
        }
        .animate-rotate-in { animation: rotate-in 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        
        /* (NOVO) Anima√ß√£o para o √≠cone de ingrediente errado */
        @keyframes shake-and-fade {
            0%, 100% { transform: translateX(0); opacity: 1; }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
            99% { opacity: 0; }
        }
        .ingredient-wrong { 
            color: #ef4444; /* Vermelho */
            animation: shake-and-fade 0.5s ease-in-out forwards;
        }

        /* (NOVO) Transi√ß√£o de cor de fundo para a tela de sucesso */
        #success-modal {
            transition: background-color 0.4s ease-out;
        }

        /* Evitar sele√ß√£o de texto */
        .no-select {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Padr√£o */
        }

        /* Estilo para as "telas" */
        .screen {
            display: none; /* Oculto por padr√£o */
            flex-direction: column;
            width: 100%;
            height: 100%;
            animation: pop-in 0.4s ease-out;
        }
        .screen.active {
            display: flex; /* Vis√≠vel quando ativo */
        }
    </style>
</head>
<body class="flex items-center justify-center h-screen no-select">

    <!-- Container Principal do App (Mobile-First) -->
    <div id="game-container" class="w-full max-w-md h-full md:h-[95vh] md:max-h-[800px] bg-white shadow-xl rounded-2xl flex flex-col overflow-hidden relative">

        <!-- ====================================================== -->
        <!-- 1. TELA DE BEM-VINDO                            -->
        <!-- ====================================================== -->
        <div id="welcome-screen" class="screen active p-8 flex-col items-center justify-center text-center">
            <i class="fas fa-utensils text-9xl text-purple-500 mb-8 animate-pulse"></i>
            <!-- (MODIFICADO) Fonte mais grossa para o t√≠tulo -->
            <h1 class="text-5xl font-black text-gray-800 mb-4">Siga a Receita</h1>
            <p class="text-xl text-gray-600 mb-12">Torne-se um Mestre Cuca!</p>
            <button id="welcome-play-button" class="btn-main w-full bg-green-500 text-white font-bold px-12 py-5 rounded-xl text-3xl shadow-lg">
                <i class="fas fa-play mr-3"></i> Jogar
            </button>
            <div class="mt-auto text-gray-500 text-sm">
                Chef Deluxe v3.0
            </div>
        </div>
        
        <!-- ====================================================== -->
        <!-- 2. TELA DE MENU (RANQUE)                               -->
        <!-- ====================================================== -->
        <div id="menu-screen" class="screen p-8 flex-col items-center justify-center text-center">
            
            <!-- (NOVO) Display de Ranque -->
            <div id="rank-display" class="text-center mb-6 w-full">
                <div id="rank-icon" class="text-8xl mb-2">üßº</div>
                <h2 id="rank-name" class="text-3xl font-bold text-gray-700">Lava-pratos</h2>
            </div>

            <!-- (NOVO) Meta para Pr√≥ximo Ranque -->
            <div id="rank-goal" class="bg-gray-100 p-4 rounded-xl mb-6 text-center w-full shadow-inner">
                <h4 class="text-lg font-bold text-purple-600">Pr√≥ximo N√≠vel</h4>
                <p id="rank-goal-text" class="text-gray-600">Compre a receita "Salada" no Mercado!</p>
            </div>

            <button id="play-button" class="btn-main w-full bg-green-500 text-white font-bold px-12 py-5 rounded-xl text-3xl shadow-lg mb-6">
                <i class="fas fa-play mr-3"></i> Pr√≥ximo Pedido
            </button>
            <button id="market-button" class="btn-main w-full bg-blue-500 text-white font-bold px-12 py-5 rounded-xl text-3xl shadow-lg">
                <i class="fas fa-store mr-3"></i> Mercado
            </button>
            <div class="mt-auto text-gray-500 text-sm">
                Chef Deluxe v3.0
            </div>
        </div>

        <!-- ====================================================== -->
        <!-- 2. TELA DE JOGO (MODIFICADA)                           -->
        <!-- ====================================================== -->
        <div id="game-screen" class="screen">
            <!-- Header (Dinheiro e Pausa) -->
            <header class="bg-white/80 backdrop-blur-sm border-b border-gray-200 p-4 flex justify-between items-center z-10">
                <button id="pause-button" class="text-gray-500 hover:text-purple-600 transition-colors duration-200 text-3xl w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-pause"></i>
                </button>
                
                <div class="flex items-center space-x-3">
                    <div id="streak-display" class="text-orange-500 font-bold text-xl transition-transform duration-300" title="Combo de Acertos"></div>
                    <div id="money-display-game" class="bg-green-500 text-white font-bold px-5 py-2 rounded-full text-lg shadow-md transition-all duration-300">
                        $50
                    </div>
                </div>
            </header>

            <!-- √Årea do Jogo -->
            <main class="flex-1 flex flex-col p-4 overflow-hidden relative text-gray-800 bg-gradient-to-b from-white to-gray-50">
                
                <!-- (NOVO) Banner de Hor√°rio de Pico -->
                <div id="rush-hour-banner" class="hidden absolute top-0 left-0 right-0 bg-red-500 text-white text-center p-2 font-bold z-20 animate-pulse">
                    <i class="fas fa-shipping-fast mr-2"></i> HOR√ÅRIO DE PICO! (Recompensas 2x)
                </div>

                <!-- Cliente e Pedido -->
                <div id="order-area" class="flex flex-col items-center mb-4 pt-8">
                    <div id="npc-display" class="text-8xl transition-transform duration-300"></div>
                    <div id="order-display" class="speech-bubble text-gray-900 font-bold text-center mt-4 w-52 transition-transform duration-200">
                        <span id="dish-emoji" class="text-6xl block"></span>
                        <span id="dish-name" class="block mt-2 text-lg"></span>
                    </div>
                </div>

                <!-- Receita -->
                <div id="recipe-list" class="text-center text-2xl min-h-[3rem] mb-2 flex flex-wrap justify-center items-center space-x-2">
                    <!-- Receita: üçû üßà üßÄ üçû -->
                </div>
                
                <!-- Barra de Tempo -->
                <div class="w-full bg-gray-200 rounded-full h-5 mb-2 overflow-hidden shadow-inner border border-gray-300">
                    <div id="timer-bar-inner" class="h-full rounded-full bg-gradient-to-r from-red-500 to-orange-400 transition-all duration-300"></div>
                </div>
                <div id="timer-text" class="text-center font-bold text-lg mb-2 text-gray-700">Tempo: 12s</div>

                <!-- Prato do Jogador -->
                <div class="bg-gray-100 border border-gray-300 rounded-lg p-3 h-[7rem] overflow-y-auto mb-4 shadow-inner flex flex-wrap justify-center items-center gap-2" id="player-plate">
                    <!-- Ingredientes selecionados -->
                </div>

                <!-- Mensagem de Feedback -->
                <div id="message-box" class="text-center text-2xl font-bold">
                    <!-- Mensagens de "Perfeito!" ou "Errado!" -->
                </div>
            </main>

            <!-- Bandeja de Ingredientes -->
            <footer class="bg-gray-100 p-4 shadow-inner border-t-2 border-gray-200">
                <div id="ingredient-bin" class="grid grid-cols-5 gap-2 justify-items-center">
                    <!-- Bot√µes de ingredientes ser√£o injetados aqui -->
                </div>
            </footer>
        </div>

        <!-- ====================================================== -->
        <!-- 3. TELA DE MERCADO (MODIFICADA)                        -->
        <!-- ====================================================== -->
        <div id="market-screen" class="screen">
            <!-- Header do Mercado -->
            <header class="bg-white/80 backdrop-blur-sm border-b border-gray-200 p-4 flex justify-between items-center z-10 w-full">
                <button id="menu-button-market" class="text-gray-500 hover:text-purple-600 transition-colors duration-200 text-3xl w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-2xl font-bold text-purple-600">Mercado</h2>
                <div id="money-display-market" class="bg-green-500 text-white font-bold px-5 py-2 rounded-full text-lg shadow-md transition-all duration-300">
                    $50
                </div>
            </header>

            <!-- Lista de Itens do Mercado -->
            <main class="flex-1 p-4 overflow-y-auto w-full space-y-3">
                <div id="market-items-grid" class="space-y-3">
                    <!-- Cards de receitas ser√£o injetados aqui -->
                </div>
            </main>
        </div>

        <!-- ====================================================== -->
        <!-- MODAIS (SOBREPOSI√á√ÉO)                                  -->
        <!-- ====================================================== -->

        <!-- Tela de Pausa (MODAL) -->
        <div id="pause-screen" class="hidden absolute inset-0 bg-black/70 z-40 flex flex-col items-center justify-center p-8 text-center backdrop-blur-sm">
            <i class="fas fa-pause-circle text-8xl text-white mb-6"></i>
            <h2 class="text-5xl font-bold mb-10 text-white">Pausado</h2>
            <button id="resume-button" class="btn-main w-full max-w-xs bg-green-500 text-white font-bold px-12 py-4 rounded-xl text-2xl shadow-lg mb-4">
                Continuar
            </button>
            <button id="menu-button-pause" class="btn-main w-full max-w-xs bg-red-500 text-white font-bold px-12 py-4 rounded-xl text-2xl shadow-lg">
                Voltar ao Menu
            </button>
        </div>

        <!-- Mensagem de Feedback do Mercado (MODAL) -->
        <div id="market-message-modal" class="hidden absolute inset-0 bg-black/70 z-50 flex flex-col items-center justify-center p-8 backdrop-blur-sm">
            <div class="bg-white p-6 rounded-2xl shadow-2xl text-center w-full max-w-sm animate-pop-in">
                <i id="market-message-icon" class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                <h3 id="market-message-title" class="text-2xl font-bold text-gray-800 mb-2"></h3>
                <p id="market-message-text" class="text-gray-600 mb-6"></p>
                <button id="market-message-close" class="btn-main w-full bg-purple-500 text-white font-bold py-3 rounded-lg text-lg">
                    OK
                </button>
            </div>
        </div>

        <!-- Tela de Sucesso (MODAL) -->
        <div id="success-modal" class="hidden absolute inset-0 bg-green-500/70 z-50 flex flex-col items-center justify-center p-8 text-center backdrop-blur-sm">
            <i id="success-icon" class="fas fa-check-circle text-8xl text-white mb-6"></i>
            <h2 id="success-message" class="text-4xl font-bold text-white">Perfeito! +$18</h2>
        </div>

    </div>

    <script>
        // --- 1. DEFINI√á√ÉO DE DADOS DO JOGO ---

        const NPCS = ["üë©‚Äçüíº", "üßë‚Äçüíª", "üë®‚Äçüé®", "üë©‚ÄçüöÄ", "üßë‚Äçüöí", "üëÆ‚Äç‚ôÄÔ∏è", "üë∑‚Äç‚ôÇÔ∏è", "üë©‚Äç‚öïÔ∏è", "üßë‚Äçüé§", "üë®‚Äçüåæ"];
        
        // (MAIS INGREDIENTES)
        const ALL_INGREDIENTS = [
            "üçû", "ü•¨", "ü•©", "üßÄ", "üçÖ", "ü•í", "üßÖ", "üå∂Ô∏è", "üåÆ", "üçô", 
            "üêü", "ü•ë", "ü•ö", "ü•ì", "üçÑ", "üå≠", "üçó", "üåΩ", "ü¶ê", "üçï",
            "ü•õ", "üçØ", "üßá", "ü•û", "ü•¶", "ü•ï", "ü´ê", "üçö", "ü•ü", "üçã",
            "üßÇ", "ü•£", "ü•ú", "ü´ò", "üéÇ", "üßà", "üåø", "üçì", "üçç", "üçÜ", "ü•î"
        ];
        
        // (MAIS RECEITAS + Estrutura de Ranque)
        const ALL_RECIPES = [
            // name: Nome do prato
            // emoji: Emoji do prato
            // price: Pre√ßo no mercado
            // minRank: O ranque M√çNIMO que o jogador deve ter para comprar.
            // baseRecipe: A receita m√≠nima obrigat√≥ria
            // optionalIngredients: Ingredientes que podem ser adicionados se o jogador os tiver desbloqueado
            
             // minRank 0 (Ranque Lava-pratos) -> Receitas que devem estar dispon√≠veis no in√≠cio
            { name: "Misto Quente", emoji: "ü•™", price: 0, minRank: 0, baseRecipe: ["üçû", "üßà", "üßÄ", "üçû"], optionalIngredients: ["üçÖ"] }, // Inicial
            { name: "Limonada", emoji: "üçã", price: 60, minRank: 0, baseRecipe: ["üçã", "üçØ"], optionalIngredients: ["üåø"] },
            { name: "Salada", emoji: "ü•ó", price: 100, minRank: 0, baseRecipe: ["ü•¨", "üçÖ", "ü•í"], optionalIngredients: ["üßÖ", "ü•ë", "üåΩ", "ü•ö"] }, // Ranque Up para Ranque 1
            
            // minRank 1 (Ranque Ajudante de Cozinha) -> Receitas dispon√≠veis AP√ìS subir de Ranque
            { name: "Sopa de Tomate", emoji: "ü•£", price: 110, minRank: 1, baseRecipe: ["üçÖ", "üßÖ", "üåø"], optionalIngredients: ["üßà"] },
            { name: "Vitamina", emoji: "ü•ë", price: 120, minRank: 1, baseRecipe: ["ü•ë", "ü•õ", "üçØ"], optionalIngredients: ["üçì"] },
            { name: "Sushi", emoji: "üç£", price: 150, minRank: 1, baseRecipe: ["üçô", "üêü", "ü•í"], optionalIngredients: ["ü•ë"] },
            { name: "Hamb√∫rguer", emoji: "üçî", price: 200, minRank: 1, baseRecipe: ["üçû", "ü•©", "ü•¨", "üçû"], optionalIngredients: ["üßÄ", "üçÖ", "ü•ì", "üßÖ"] }, // Ranque Up para Ranque 2
            
            // minRank 2 (Ranque Cozinheiro J√∫nior)
            { name: "Batata Frita", emoji: "üçü", price: 200, minRank: 2, baseRecipe: ["ü•î", "üßà", "üßÇ"], optionalIngredients: ["üßÄ"] },
            { name: "Panquecas", emoji: "ü•û", price: 220, minRank: 2, baseRecipe: ["ü•û", "üßà", "üçØ"], optionalIngredients: ["üçì", "ü´ê"] },
            { name: "Cachorro-Quente", emoji: "üå≠", price: 250, minRank: 2, baseRecipe: ["üå≠", "ü•ì"], optionalIngredients: ["üßÖ", "ü•í", "üå∂Ô∏è"] },
            { name: "Waffles", emoji: "üßá", price: 280, minRank: 2, baseRecipe: ["üßá", "üßà", "üçì"], optionalIngredients: ["ü´ê", "üçØ"] },
            { name: "Omelete", emoji: "üç≥", price: 300, minRank: 2, baseRecipe: ["ü•ö", "ü•ö", "üßà"], optionalIngredients: ["üßÄ", "üçÑ", "üåø", "üçÖ"] },
            { name: "Taco", emoji: "üåÆ", price: 350, minRank: 2, baseRecipe: ["üåÆ", "ü•©", "ü•¨"], optionalIngredients: ["üçÖ", "üßÄ", "üå∂Ô∏è"] }, // Ranque Up para Ranque 3

            // minRank 3 (Ranque Cozinheiro Pleno)
            { name: "Frango c/ Legumes", emoji: "üçó", price: 320, minRank: 3, baseRecipe: ["üçó", "ü•¶", "ü•ï"], optionalIngredients: ["üåø"] },
            { name: "Salada Caesar", emoji: "ü•ó", price: 360, minRank: 3, baseRecipe: ["ü•¨", "üçû", "üßÄ", "üçó"], optionalIngredients: ["ü•ì"] },
            { name: "Sandu√≠che de Atum", emoji: "ü•™", price: 380, minRank: 3, baseRecipe: ["üçû", "üêü", "ü•¨"], optionalIngredients: ["üçÖ", "üßÖ"] },
            { name: "Kebab", emoji: "ü•ô", price: 400, minRank: 3, baseRecipe: ["üçû", "üçó", "ü•¨"], optionalIngredients: ["üçÖ", "üßÖ"] },
            { name: "Onigiri", emoji: "üçô", price: 450, minRank: 3, baseRecipe: ["üçô", "üçö", "üêü"], optionalIngredients: ["üåø"] },
            { name: "Pizza Slice", emoji: "üçï", price: 500, minRank: 3, baseRecipe: ["üçï", "üçÖ", "üßÄ"], optionalIngredients: ["üå∂Ô∏è", "ü•ì", "üçÑ"] }, // Ranque Up para Ranque 4

            // minRank 4 (Ranque Subchefe)
            { name: "Ensopado", emoji: "üç≤", price: 550, minRank: 4, baseRecipe: ["ü•î", "ü•ï", "üßÖ"], optionalIngredients: ["ü•¶", "ü•©"] },
            { name: "Chilli", emoji: "üå∂Ô∏è", price: 580, minRank: 4, baseRecipe: ["ü•©", "ü´ò", "üå∂Ô∏è", "üçÖ"], optionalIngredients: ["üßÖ"] },
            { name: "Ratatouille", emoji: "üç≤", price: 600, minRank: 4, baseRecipe: ["üçÖ", "üçÜ", "ü•í"], optionalIngredients: ["üßÖ", "üåø"] },
            { name: "Guioza", emoji: "ü•ü", price: 650, minRank: 4, baseRecipe: ["ü•ü", "ü•©", "ü•¨"], optionalIngredients: ["üßÖ"] },
            { name: "Temaki", emoji: "üç£", price: 750, minRank: 4, baseRecipe: ["üçô", "üçö", "üêü", "ü•ë"], optionalIngredients: ["ü•í"] },
            { name: "Ramen", emoji: "üçú", price: 800, minRank: 4, baseRecipe: ["üçú", "ü•©", "ü•ö"], optionalIngredients: ["üåø", "üåΩ"] }, // Ranque Up para Ranque 5

            // minRank 5 (Ranque Chefe de Cozinha)
            { name: "Salada de Frutas", emoji: "üçì", price: 800, minRank: 5, baseRecipe: ["üçì", "üçç"], optionalIngredients: ["ü•ë", "ü´ê", "üçØ"] },
            { name: "Camar√£o", emoji: "ü¶ê", price: 850, minRank: 5, baseRecipe: ["ü¶ê", "üßà", "üåø"], optionalIngredients: ["üçã"] },
            { name: "Bolo", emoji: "üéÇ", price: 900, minRank: 5, baseRecipe: ["üéÇ", "üçì", "ü•õ", "üçØ"], optionalIngredients: ["ü´ê"] },
            { name: "Paella", emoji: "ü•ò", price: 950, minRank: 5, baseRecipe: ["üçö", "ü¶ê", "üå∂Ô∏è", "üçó"], optionalIngredients: ["üçã"] },
            { name: "Salm√£o Grelhado", emoji: "üêü", price: 1000, minRank: 5, baseRecipe: ["üêü", "üçã", "üåø"], optionalIngredients: ["ü•î"] } // Ranque Up para Ranque 6
        ];

        // (NOVO) Sistema de Ranks
        const RANKS = [
            { name: "Lava-pratos", icon: "üßº", recipeToUnlock: "Salada" }, // Rank 0
            { name: "Ajudante de Cozinha", icon: "üßë‚Äçüç≥", recipeToUnlock: "Hamb√∫rguer" }, // Rank 1
            { name: "Cozinheiro J√∫nior", icon: "üî™", recipeToUnlock: "Taco" }, // Rank 2
            { name: "Cozinheiro Pleno", icon: "ü•ò", recipeToUnlock: "Pizza Slice" }, // Rank 3
            { name: "Subchefe", icon: "ü•à", recipeToUnlock: "Ramen" }, // Rank 4
            { name: "Chefe de Cozinha", icon: "ü•á", recipeToUnlock: "Salm√£o Grelhado" }, // Rank 5
            { name: "Mestre Cuca", icon: "üèÜ", recipeToUnlock: null } // Rank 6 (M√°x)
        ];

        // --- 2. VARI√ÅVEIS DE ESTADO DO JOGO ---
        const SAVE_KEY = 'recipeGameData_v2'; // Chave salva

        // Estado do jogo salvo
        let gameState = {
            money: 50,
            unlockedRecipeNames: ["Misto Quente"],
            // (CORRE√á√ÉO) Adicionado todos os ingredientes base das receitas minRank: 0
            unlockedIngredientEmojis: ["üçû", "üßà", "üßÄ", "üçÖ", "üçã", "üçØ", "ü•¨", "ü•í"],
            rank: 0
        };

        // Estado da sess√£o (n√£o salvo)
        let currentStreak = 0;
        let currentOrder = null;
        let playerSelection = [];
        let timer = 10;
        let timerId = null;
        let gameActive = false;
        let isPaused = false;
        let isRushHour = false;
        
        const PENALTY_FAILURE = 10;

        // --- 3. SELETORES DO DOM ---
        // Telas
        const welcomeScreen = document.getElementById('welcome-screen');
        const menuScreen = document.getElementById('menu-screen');
        const gameScreen = document.getElementById('game-screen');
        const marketScreen = document.getElementById('market-screen');
        const pauseScreen = document.getElementById('pause-screen');
        const marketMessageModal = document.getElementById('market-message-modal');
        const successModal = document.getElementById('success-modal');
        const successMessage = document.getElementById('success-message');
        const successIcon = document.getElementById('success-icon');
        const rushHourBanner = document.getElementById('rush-hour-banner');

        // Bot√µes de Navega√ß√£o
        const welcomePlayButton = document.getElementById('welcome-play-button');
        const playButton = document.getElementById('play-button');
        const marketButton = document.getElementById('market-button');
        const pauseButton = document.getElementById('pause-button');
        const resumeButton = document.getElementById('resume-button');
        const menuButtonPause = document.getElementById('menu-button-pause');
        const menuButtonMarket = document.getElementById('menu-button-market');
        const marketMessageClose = document.getElementById('market-message-close');

        // Displays de Dinheiro
        const moneyDisplayGame = document.getElementById('money-display-game');
        const moneyDisplayMarket = document.getElementById('money-display-market');
        const streakDisplay = document.getElementById('streak-display');
        
        // Displays de Ranque (Menu)
        const rankIcon = document.getElementById('rank-icon');
        const rankName = document.getElementById('rank-name');
        const rankGoal = document.getElementById('rank-goal');
        const rankGoalText = document.getElementById('rank-goal-text');

        // Jogo
        const npcDisplay = document.getElementById('npc-display');
        const dishEmoji = document.getElementById('dish-emoji');
        const dishName = document.getElementById('dish-name');
        const orderDisplay = document.getElementById('order-display');
        const recipeList = document.getElementById('recipe-list');
        const timerText = document.getElementById('timer-text');
        const timerBarInner = document.getElementById('timer-bar-inner');
        const playerPlate = document.getElementById('player-plate');
        const messageBox = document.getElementById('message-box');
        const ingredientBin = document.getElementById('ingredient-bin');
        const orderArea = document.getElementById('order-area');

        // Mercado
        const marketItemsGrid = document.getElementById('market-items-grid');
        const marketMessageIcon = document.getElementById('market-message-icon');
        const marketMessageTitle = document.getElementById('market-message-title');
        const marketMessageText = document.getElementById('market-message-text');

        // --- 4. FUN√á√ïES DE NAVEGA√á√ÉO E ESTADO ---

        /**
         * Mostra uma tela e oculta as outras
         */
        function showScreen(screenId) {
            [welcomeScreen, menuScreen, gameScreen, marketScreen].forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        /**
         * Salva o estado do jogo no localStorage
         */
        function saveGame() {
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        }

        /**
         * Carrega o estado do jogo do localStorage
         */
        function loadGame() {
            const savedData = localStorage.getItem(SAVE_KEY);
            if (savedData) {
                gameState = JSON.parse(savedData);
            }
            // Garante que os dados iniciais existam se for um save antigo
            if (!gameState.unlockedRecipeNames || !gameState.unlockedIngredientEmojis.length) {
                gameState.unlockedRecipeNames = ["Misto Quente"];
                // (CORRE√á√ÉO) Inicializa√ß√£o robusta
                gameState.unlockedIngredientEmojis = ["üçû", "üßà", "üßÄ", "üçÖ", "üçã", "üçØ", "ü•¨", "ü•í"];
            }
            // Garante compatibilidade de ranque
            if (gameState.rank === undefined) {
                gameState.rank = 0;
            }
            updateAllMoneyDisplays();
            updateRankDisplay();
        }

        /**
         * (NOVO) Atualiza a UI de Ranque no Menu
         */
        function updateRankDisplay() {
            const currentRank = RANKS[gameState.rank];
            rankIcon.textContent = currentRank.icon;
            rankName.textContent = currentRank.name;

            const nextRank = RANKS[gameState.rank + 1];
            if (nextRank) {
                // Adiciona o emoji do prato ao texto do objetivo
                const goalRecipe = ALL_RECIPES.find(r => r.name === currentRank.recipeToUnlock);
                
                rankGoal.style.display = 'block';
                // Ranque up √© definido pela receita do ranque ATUAL.
                rankGoalText.innerHTML = `Compre a receita 
                    <span class="font-bold text-gray-800">${goalRecipe.emoji} ${currentRank.recipeToUnlock}</span> 
                    no Mercado para atingir <span class="text-purple-600">${nextRank.name}</span>!`;
                
                playButton.classList.remove('bg-yellow-500'); // Garante que n√£o est√° em modo "final"
                playButton.classList.add('bg-green-500');
            } else {
                // Ranque M√°ximo
                rankGoal.style.display = 'none';
                rankName.textContent = "Mestre Cuca"; // Nome especial
                rankIcon.textContent = "üèÜ";
                playButton.classList.remove('bg-green-500');
                playButton.classList.add('bg-yellow-500'); // Bot√£o dourado
            }
        }

        /**
         * Volta para o menu principal
         */
        function goToMenu() {
            gameActive = false; // Para o jogo
            isPaused = false;
            clearInterval(timerId); // Para o timer
            pauseScreen.classList.add('hidden'); // Esconde a pausa
            showScreen('menu-screen');
            updateAllMoneyDisplays(); 
            updateRankDisplay();
        }

        /**
         * Inicia o jogo
         */
        function startGame() {
            showScreen('game-screen');
            renderUnlockedIngredientBin();
            startNewOrder();
        }

        /**
         * Mostra o mercado
         */
        function showMarket() {
            showScreen('market-screen');
            renderMarket();
            updateAllMoneyDisplays();
        }

        /**
         * Mostra uma mensagem no modal do mercado
         */
        function showMarketMessage(title, text, isSuccess = true) {
            marketMessageTitle.textContent = title;
            marketMessageText.textContent = text;
            
            marketMessageIcon.classList.remove(isSuccess ? 'fa-times-circle' : 'fa-check-circle', isSuccess ? 'text-red-500' : 'text-green-500');
            marketMessageIcon.classList.add(isSuccess ? 'fa-check-circle' : 'fa-times-circle', isSuccess ? 'text-green-500' : 'text-red-500');
            
            marketMessageModal.classList.remove('hidden');
            marketMessageModal.classList.add('flex');
        }

        // --- 5. FUN√á√ïES DE L√ìGICA DO MERCADO ---

        /**
         * Renderiza os itens no mercado
         */
        function renderMarket() {
            marketItemsGrid.innerHTML = '';
            
            const currentRank = RANKS[gameState.rank];
            const rankUpRecipe = ALL_RECIPES.find(r => r.name === currentRank.recipeToUnlock);
            
            ALL_RECIPES.forEach(recipe => {
                const isUnlocked = gameState.unlockedRecipeNames.includes(recipe.name);
                
                // Ranque M√≠nimo para comprar
                const isBuyable = gameState.rank >= recipe.minRank;
                
                // Se o Ranque Atual ainda n√£o comprou a Receita de Ranque Up
                const isRankUpCard = currentRank.recipeToUnlock && recipe.name === currentRank.recipeToUnlock && !isUnlocked;
                
                const card = document.createElement('div');
                card.className = `bg-white rounded-xl shadow-lg p-4 flex items-center space-x-4 transition-all ${isUnlocked ? 'opacity-60' : 'hover:bg-gray-50'} ${!isBuyable && !isUnlocked ? 'opacity-50' : ''} ${isRankUpCard ? 'rank-up-card' : ''}`;
                
                // Mostra todos os ingredientes
                const allRecipeIngredients = [...recipe.baseRecipe, ...recipe.optionalIngredients];
                const uniqueIngredients = [...new Set(allRecipeIngredients)]; // Remove duplicatas
                let ingredientsHTML = uniqueIngredients
                    .map(emoji => `<span class="text-sm">${emoji}</span>`)
                    .join(' + ');

                // Adiciona um r√≥tulo de Ranque Up
                let labelHTML = '';
                if (isRankUpCard) {
                    const nextRankName = RANKS[gameState.rank + 1]?.name || 'Ranque M√°ximo';
                    labelHTML = `<span class="absolute top-0 right-0 bg-yellow-500 text-white text-xs font-bold px-3 py-1 rounded-bl-xl rounded-tr-xl shadow-md">
                        META RANQUE ${RANKS[gameState.rank].icon}
                    </span>`;
                }

                card.innerHTML = `
                    ${labelHTML}
                    <div class="text-5xl">${recipe.emoji}</div>
                    <div class="flex-1">
                        <h4 class="text-xl font-bold text-gray-800">${recipe.name}</h4>
                        <p class="text-gray-500 text-sm">${ingredientsHTML}</p>
                    </div>
                    ${isUnlocked ? 
                        `<div class="text-green-500 font-bold px-4 py-2 rounded-lg bg-green-100">Comprado</div>` :
                    isBuyable ? // Verifica se √© compr√°vel
                        `<button class="btn-main ${isRankUpCard ? 'bg-yellow-500' : 'bg-purple-500'} text-white font-bold px-6 py-3 rounded-lg text-lg" data-recipe="${recipe.name}">
                            <i class="fas ${isRankUpCard ? 'fa-star' : 'fa-coins'} mr-1"></i> $${recipe.price}
                        </button>` :
                        // (APRIMORADO) Mostra explicitamente o ranque necess√°rio para maior clareza
                        `<div class="text-red-500 font-bold px-4 py-2 rounded-lg bg-red-100 text-center">
                            <i class="fas fa-lock mr-1"></i><br>
                            <span class="text-sm">Ranque Necess√°rio:<br>
                            ${RANKS[recipe.minRank].icon} ${RANKS[recipe.minRank].name}</span>
                        </div>`
                    }
                `;
                
                // S√≥ adiciona listener se for compr√°vel e n√£o desbloqueado
                if (!isUnlocked && isBuyable) {
                    card.querySelector('button').addEventListener('click', () => buyRecipe(recipe.name));
                }
                
                marketItemsGrid.appendChild(card);
            });
        }

        /**
         * Tenta comprar uma receita
         */
        function buyRecipe(recipeName) {
            const recipe = ALL_RECIPES.find(r => r.name === recipeName);
            
            if (gameState.money >= recipe.price) {
                // Deduz o dinheiro
                updateMoney(-recipe.price);
                
                // Adiciona a receita
                gameState.unlockedRecipeNames.push(recipe.name);
                
                // Adiciona os ingredientes base E os opcionais (usando Set para evitar duplicatas)
                const ingredientsSet = new Set(gameState.unlockedIngredientEmojis);
                recipe.baseRecipe.forEach(ingredient => ingredientsSet.add(ingredient));
                recipe.optionalIngredients.forEach(ingredient => ingredientsSet.add(ingredient));
                gameState.unlockedIngredientEmojis = Array.from(ingredientsSet);
                
                saveGame();
                
                // Verifica o objetivo do SEU ranque ATUAL.
                const currentRankGoal = RANKS[gameState.rank].recipeToUnlock;
                
                // Se a receita comprada √© a meta do ranque atual, sobe de ranque.
                if (currentRankGoal && recipeName === currentRankGoal) {
                    gameState.rank++;
                    saveGame();
                    showMarketMessage("Voc√™ subiu de ranque!", `Parab√©ns, voc√™ agora √© ${RANKS[gameState.rank].name}!`, true);
                    // O novo ranque ser√° exibido corretamente quando o mercado for re-renderizado
                } else {
                    showMarketMessage("Receita Comprada!", `Voc√™ aprendeu a fazer ${recipe.name}!`, true);
                }
                
                renderMarket(); // Re-renderiza o mercado
            } else {
                // Dinheiro insuficiente
                showMarketMessage("Dinheiro Insuficiente!", `Voc√™ precisa de $${recipe.price} para comprar ${recipe.name}.`, false);
            }
        }

        // --- 6. FUN√á√ïES PRINCIPAIS DO JOGO ---

        /**
         * Retorna os valores de recompensa e b√¥nus baseados no ranque atual.
         */
        function getRankRewardInfo() {
            const currentRank = gameState.rank;
            
            // O targetMinRank √© o ranque atual.
            const targetMinRank = Math.min(currentRank, RANKS.length - 2); 
            
            // Encontra as receitas para o rank que o jogador est√° jogando
            const rankRecipes = ALL_RECIPES.filter(r => r.minRank === targetMinRank);
            
            if (rankRecipes.length === 0) {
                // Fallback para Ranque M√°ximo
                if (currentRank === RANKS.length - 1) {
                     const maxRank = RANKS.length - 2; // Rank 5
                     const maxRankRecipes = ALL_RECIPES.filter(r => r.minRank === maxRank);
                     const maxPrice = Math.max(...maxRankRecipes.map(r => r.price));
                     
                     const baseReward = Math.max(15, Math.round(maxPrice * 0.08)); 
                     const streakBonus = Math.max(3, Math.round(baseReward * 0.2));
                     return { baseReward, streakBonus };
                }
                return { baseReward: 10, streakBonus: 2 }; // Fallback geral
            }
            
            // Acha o pre√ßo m√°ximo nesse Rank
            const maxPrice = Math.max(...rankRecipes.map(r => r.price));
            
            // Recompensa base: 5% do pre√ßo m√°ximo, com m√≠nimo de $10
            const baseReward = Math.max(10, Math.round(maxPrice * 0.05));
            // B√¥nus de combo: 20% da recompensa base, com m√≠nimo de $2
            const streakBonus = Math.max(2, Math.round(baseReward * 0.2));
            
            return { baseReward, streakBonus };
        }

        /**
         * Retorna a dura√ß√£o do timer baseada no ranque
         */
        function getTimerDuration() {
            const baseTimer = 12; // 12 segundos no ranque 0
            const duration = baseTimer - gameState.rank; // Perde 1s por ranque
            let finalDuration = Math.max(duration, 5); // M√≠nimo de 5 segundos
            
            if (isRushHour) {
                finalDuration = Math.max(Math.round(finalDuration * 0.7), 3); // 30% mais r√°pido, min 3s
            }
            return finalDuration;
        }

        /**
         * Renderiza APENAS os ingredientes desbloqueados
         */
        function renderUnlockedIngredientBin() {
            ingredientBin.innerHTML = '';
            // Embaralha apenas os ingredientes desbloqueados
            const shuffledIngredients = [...gameState.unlockedIngredientEmojis].sort(() => Math.random() - 0.5);
            
            shuffledIngredients.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = "ingredient-btn rounded-lg p-3 text-4xl shadow-md no-select";
                btn.textContent = emoji;
                btn.dataset.emoji = emoji;
                ingredientBin.appendChild(btn);
            });
            // Anima√ß√£o da bandeja
            ingredientBin.parentElement.classList.remove('animate-slide-in-bottom');
            void ingredientBin.parentElement.offsetWidth;
            ingredientBin.parentElement.classList.add('animate-slide-in-bottom');
        }

        /**
         * Inicia um novo pedido
         */
        function startNewOrder() {
            gameActive = true;
            isPaused = false;
            playerSelection = [];
            timer = getTimerDuration();
            
            if (isRushHour) {
                rushHourBanner.classList.remove('hidden');
            } else {
                rushHourBanner.classList.add('hidden');
            }

            // Escolhe uma receita APENAS das desbloqueadas
            const availableRecipes = ALL_RECIPES.filter(r => gameState.unlockedRecipeNames.includes(r.name));
            currentOrder = { ...availableRecipes[Math.floor(Math.random() * availableRecipes.length)] };
            
            // Gerar receita din√¢mica
            let finalRecipe = [...currentOrder.baseRecipe]; // Come√ßa com a base
            
            // Filtra opcionais que o jogador J√Å DESBLOQUEOU
            const availableOptionals = currentOrder.optionalIngredients.filter(
                ingredient => gameState.unlockedIngredientEmojis.includes(ingredient)
            );
            
            // Chance de adicionar opcionais aumenta com o ranque
            const optionalChance = 0.3 + (gameState.rank * 0.1); // 30% (rank 0) -> 90% (rank 6)
            const optionalsToAdd = availableOptionals.filter(() => Math.random() < optionalChance);

            if (optionalsToAdd.length > 0 && finalRecipe.length > 1) {
                // Insere os opcionais antes do √∫ltimo item da receita base
                const lastItem = finalRecipe.pop();
                finalRecipe = [...finalRecipe, ...optionalsToAdd, lastItem];
            } else if (optionalsToAdd.length > 0) {
                // Para receitas de 1 item, apenas adiciona no final
                finalRecipe = [...finalRecipe, ...optionalsToAdd];
            }
            
            currentOrder.recipe = finalRecipe;
            
            // Resetar UI
            playerPlate.innerHTML = '';
            messageBox.textContent = '';
            messageBox.className = "text-center text-2xl font-bold";
            
            // Mostra a receita imediatamente (com cor)
            recipeList.innerHTML = `Receita: <span class="font-bold text-purple-600 ml-2">${currentOrder.recipe.join(' ')}</span>`;
            
            // Mostrar novo pedido
            npcDisplay.textContent = NPCS[Math.floor(Math.random() * NPCS.length)];
            dishEmoji.textContent = currentOrder.emoji;
            dishName.textContent = currentOrder.name;
            
            // Anima√ß√£o do NPC e do pedido
            npcDisplay.classList.remove('animate-rotate-in');
            orderArea.classList.remove('animate-pop-in');
            
            void npcDisplay.offsetWidth; // For√ßa rein√≠cio da anima√ß√£o
            void orderArea.offsetWidth;
            
            npcDisplay.classList.add('animate-rotate-in');
            orderArea.classList.add('animate-pop-in');

            startTimer();
        }

        /**
         * Lida com o clique em um ingrediente
         */
        function handleIngredientClick(e) {
            if (!gameActive || isPaused || !e.target.matches('.ingredient-btn')) return;

            const clickedEmoji = e.target.dataset.emoji;
            playerSelection.push(clickedEmoji);
            
            // Atualiza o prato do jogador (visual)
            const emojiSpan = document.createElement('span');
            emojiSpan.className = 'text-3xl animate-pop-in';
            emojiSpan.textContent = clickedEmoji;
            
            // Verifica√ß√£o de erro imediato (ordem importa!)
            const currentIndex = playerSelection.length - 1;
            if (playerSelection[currentIndex] !== currentOrder.recipe[currentIndex]) {
                // Feedback visual de erro
                emojiSpan.classList.add('ingredient-wrong'); 
                playerPlate.appendChild(emojiSpan);
                checkOrder(false, "Ingrediente errado!");
                return;
            }
            
            // Ingrediente correto
            playerPlate.appendChild(emojiSpan);

            // Verifica√ß√£o de sucesso (completou a receita)
            if (playerSelection.length === currentOrder.recipe.length) {
                checkOrder(true);
            }
        }

        /**
         * Inicia o contador regressivo
         */
        function startTimer() {
            clearInterval(timerId);
            timer = getTimerDuration();
            timerText.textContent = `Tempo: ${timer}s`;
            
            // Reseta a anima√ß√£o da barra
            timerBarInner.classList.remove('timer-bar-inner-animate');
            void timerBarInner.offsetWidth;
            timerBarInner.classList.add('timer-bar-inner-animate');
            timerBarInner.style.animationDuration = `${timer}s`; // Usa o timer din√¢mico
            timerBarInner.style.animationPlayState = 'running';

            startTimerInterval();
        }

        /**
         * Inicia o intervalo do contador
         */
        function startTimerInterval() {
            clearInterval(timerId);
            timerId = setInterval(() => {
                if (isPaused) return;

                timer--;
                timerText.textContent = `Tempo: ${timer}s`;
                
                if (timer <= 0) {
                    checkOrder(false, "Tempo esgotado!");
                }
            }, 1000);
        }

        /**
         * Pausa o jogo
         */
        function pauseGame() {
            if (!gameActive) return;
            
            isPaused = true;
            clearInterval(timerId);
            timerBarInner.style.animationPlayState = 'paused';
            pauseScreen.classList.remove('hidden');
            pauseScreen.classList.add('flex');
        }

        /**
         * Retoma o jogo
         */
        function resumeGame() {
            if (!gameActive) return;

            isPaused = false;
            startTimerInterval();
            timerBarInner.style.animationPlayState = 'running';
            pauseScreen.classList.add('hidden');
            pauseScreen.classList.remove('flex');
        }

        /**
         * Verifica o pedido
         */
        function checkOrder(isSuccess, failReason = "") {
            if (!gameActive) return;
            
            gameActive = false;
            clearInterval(timerId);
            timerBarInner.classList.remove('timer-bar-inner-animate');
            
            if (isSuccess) {
                // Sucesso
                currentStreak++;
                
                const { baseReward, streakBonus } = getRankRewardInfo();
                const currentStreakBonus = (currentStreak - 1) * streakBonus; // B√¥nus s√≥ come√ßa no segundo acerto
                let totalReward;
                let successMsg;

                if (isRushHour) {
                    totalReward = (baseReward * 2) + (currentStreakBonus * 2);
                    successMsg = `HOR√ÅRIO DE PICO! +$${totalReward}`;
                    isRushHour = false; // Termina o rush hour
                } else { // Pedido normal
                    totalReward = baseReward + currentStreakBonus;
                    successMsg = `Perfeito! +$${baseReward}`;
                    if (currentStreakBonus > 0) {
                        successMsg += ` (Combo +$${currentStreakBonus})`;
                    }
                    // Chance de iniciar o pr√≥ximo rush hour
                    if (Math.random() < 0.20) { // 20% de chance
                        isRushHour = true;
                    }
                }
                
                updateMoney(totalReward);
                // Chama a nova tela de sucesso
                showSuccessScreen(successMsg);
                
            } else {
                // Falha
                currentStreak = 0;
                isRushHour = false;
                const reason = failReason || "Pedido errado!";
                
                // Garante que a penalidade n√£o deixe o dinheiro negativo
                let penalty = PENALTY_FAILURE;
                if (gameState.money < penalty) {
                    penalty = gameState.money; // Perde apenas o que tem
                }
                
                updateMoney(-penalty); // Passa o valor negativo
                showMessage(`${reason} -$${penalty}`, false);

                // S√≥ inicia o pr√≥ximo pedido se falhar
                setTimeout(startNewOrder, 2000);
            }
            
            updateStreakDisplay();
            saveGame(); // Salva o progresso (dinheiro e ranque)
        }

        // --- 7. FUN√á√ïES AUXILIARES DE UI ---

        /**
         * Mostra a tela de sucesso
         */
        function showSuccessScreen(message) {
            successMessage.textContent = message;
            successModal.classList.remove('hidden');
            successModal.classList.add('flex');
            
            // Anima√ß√£o do √≠cone
            successIcon.classList.remove('animate-pulse-success');
            void successIcon.offsetWidth; // Reinicia a anima√ß√£o
            successIcon.classList.add('animate-pulse-success');

            // Esconde a tela e inicia o pr√≥ximo pedido
            setTimeout(() => {
                successModal.classList.add('hidden');
                successModal.classList.remove('flex');
                startNewOrder(); // Inicia o pr√≥ximo pedido AQUI
            }, 1500); // Tela de sucesso dura 1.5s
        }

        /**
         * Atualiza TODOS os displays de dinheiro
         */
        function updateAllMoneyDisplays() {
            const moneyStr = `$${gameState.money}`;
            moneyDisplayGame.textContent = moneyStr;
            moneyDisplayMarket.textContent = moneyStr;

            // Anima√ß√£o de "pulso"
            [moneyDisplayGame, moneyDisplayMarket].forEach(display => {
                display.classList.remove('scale-110');
                void display.offsetWidth;
                display.classList.add('scale-110');
                setTimeout(() => display.classList.remove('scale-110'), 200);
            });
        }

        /**
         * Atualiza o dinheiro e chama a atualiza√ß√£o da UI
         */
        function updateMoney(amount) {
            gameState.money += amount;
            
            // Regra principal: Dinheiro NUNCA fica abaixo de 0
            if (gameState.money < 0) {
                gameState.money = 0;
            }
            
            updateAllMoneyDisplays();
        }

        /**
         * Atualiza o visual do combo
         */
        function updateStreakDisplay() {
            if (currentStreak > 1) { // S√≥ mostra o combo a partir de 2x
                streakDisplay.textContent = `${currentStreak}x üî•`;
                streakDisplay.classList.add('animate-pulse-orange');
                setTimeout(() => streakDisplay.classList.remove('animate-pulse-orange'), 300);
            } else {
                streakDisplay.textContent = '';
            }
        }
        
        /**
         * Mostra uma mensagem de feedback
         */
        function showMessage(text, isSuccess) {
            messageBox.textContent = text;
            if (isSuccess) {
                messageBox.classList.add('message-success');
            } else {
                messageBox.classList.add('message-error');
            }
        }

        // --- 8. INICIAR O JOGO ---
        
        // Listeners de navega√ß√£o
        welcomePlayButton.addEventListener('click', () => showScreen('menu-screen'));
        playButton.addEventListener('click', startGame);
        marketButton.addEventListener('click', showMarket);
        
        pauseButton.addEventListener('click', pauseGame);
        resumeButton.addEventListener('click', resumeGame);
        
        menuButtonPause.addEventListener('click', goToMenu);
        menuButtonMarket.addEventListener('click', goToMenu);

        marketMessageClose.addEventListener('click', () => {
            marketMessageModal.classList.add('hidden');
            marketMessageModal.classList.remove('flex');
        });

        // Listeners do Jogo
        ingredientBin.addEventListener('click', handleIngredientClick);
        
        // Carregar o jogo quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', loadGame);

    </script>
</body>
</html>
